<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세히의 게임</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            color: #fff;
        }

        .game-container {
            width: 800px;
            height: 600px;
            border: 2px solid #fff;
            overflow: hidden;
            position: relative;
        }

        .scene {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #background {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .text-box {
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            box-sizing: border-box;
            z-index: 2;
        }

        #dialogue {
            margin: 0;
        }

        .choices {
            margin-top: 10px;
            display: flex;
            justify-content: space-around;
        }

        .choice {
            background-color: #444;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .choice:hover {
            background-color: #666;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="scene" class="scene">
            <div id="text-box" class="text-box">
                <p id="dialogue"></p>
            </div>
            <div id="choices" class="choices">
                <!-- 선택지가 이곳에 동적으로 추가됩니다 -->
            </div>
        </div>
    </div>
    <script>
        // 게임의 장면과 대화 데이터를 정의합니다.
        const scenes = {
            start: {
                dialogue: [
                    '어두운 숲 속에서 당신은 길을 잃었습니다.',
                    '어디로 가시겠습니까?'
                ],
                choices: [
                    { text: '왼쪽 길', nextScene: 'leftPath' },
                    { text: '오른쪽 길', nextScene: 'rightPath' }
                ]
            },
            leftPath: {
                dialogue: [
                    '왼쪽 길로 들어섰습니다.',
                    '잠시 후 당신은 무언가 이상한 소리를 듣습니다.'
                ],
                choices: [
                    { text: '소리를 따라간다', nextScene: 'followSound' },
                    { text: '무시하고 계속 간다', nextScene: 'ignoreSound' }
                ]
            },
            rightPath: {
                dialogue: [
                    '오른쪽 길로 들어섰습니다.',
                    '앞에는 험난한 산길이 보입니다.'
                ],
                choices: [
                    { text: '산길을 오른다', nextScene: 'climbMountain' },
                    { text: '돌아간다', nextScene: 'start' }
                ]
            },
            followSound: {
                dialogue: [
                    '당신은 소리를 따라가다가 숲 속의 비밀 장소를 발견합니다.'
                ],
                choices: [
                    { text: '탐험한다', nextScene: 'explore' },
                    { text: '다시 돌아간다', nextScene: 'start' }
                ]
            },
            ignoreSound: {
                dialogue: [
                    '당신은 소리를 무시하고 길을 계속 걷습니다.',
                    '결국 길을 벗어나 버렸습니다.'
                ],
                choices: [
                    { text: '다시 시작하기', nextScene: 'start' }
                ]
            },
            climbMountain: {
                dialogue: [
                    '당신은 산길을 오르다 넘어져 큰 부상을 입습니다.'
                ],
                choices: [
                    { text: '다시 시작하기', nextScene: 'start' }
                ]
            },
            explore: {
                dialogue: [
                    '당신은 숲 속의 비밀 장소에서 보물을 발견했습니다!'
                ],
                choices: [
                    { text: '다시 시작하기', nextScene: 'start' }
                ]
            }
        };

        let typingTimeout;
        let currentDialogue = '';
        let isTyping = false;
        let currentDialogueIndex = 0;

        function typeText(text, element, callback) {
            let i = 0;
            currentDialogue = text;
            element.textContent = '';
            isTyping = true;

            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    typingTimeout = setTimeout(type, 30); // 타이핑 속도 설정 (50ms)
                } else {
                    isTyping = false;
                    if (callback) callback();
                }
            }

            type();
        }

        function showScene(sceneName) {
            const scene = scenes[sceneName];
            const dialogueElement = document.getElementById('dialogue');
            const choicesContainer = document.getElementById('choices');

            // 초기화
            clearTimeout(typingTimeout);
            isTyping = false;
            currentDialogueIndex = 0;

            // 클릭 이벤트 리스너 제거 후 다시 설정 (중복 방지)
            document.body.onclick = null;
            document.body.onclick = () => {
                if (isTyping) {
                    clearTimeout(typingTimeout);
                    dialogueElement.textContent = currentDialogue;
                    isTyping = false;
                } else {
                    if (currentDialogueIndex < scene.dialogue.length) {
                        showNextDialogue();
                    } else {
                        showChoices(scene.choices);
                    }
                }
            };

            function showNextDialogue() {
                if (currentDialogueIndex < scene.dialogue.length) {
                    typeText(scene.dialogue[currentDialogueIndex], dialogueElement, () => {
                        currentDialogueIndex++;
                    });
                } else {
                    showChoices(scene.choices);
                }
            }

            showNextDialogue();
        }

        function showChoices(choices) {
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = ''; // 이전의 선택지를 지웁니다.
            choices.forEach(choice => {
                const choiceElement = document.createElement('div');
                choiceElement.textContent = choice.text;
                choiceElement.classList.add('choice');
                choiceElement.addEventListener('click', (event) => {
                    event.stopPropagation(); // 이벤트가 부모 요소로 전달되지 않도록 함
                    // 선택지 클릭 후 버튼 숨기기
                    choicesContainer.innerHTML = '';
                    showScene(choice.nextScene);
                });
                choicesContainer.appendChild(choiceElement);
            });
        }

        // 게임 시작 시 초기 장면을 표시합니다.
        showScene('start');
    </script>
</body>
</html>
